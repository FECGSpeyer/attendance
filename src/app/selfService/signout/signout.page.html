<ion-header>
  <ion-toolbar>
    <ion-title>{{ name }}</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="logout()">
        <ion-icon name="log-out-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content *ngIf="player">
  <ion-item lines="none">
    <ion-label *ngIf="!player.paused">Shalom {{ player.firstName }}!</ion-label>
    <ion-label *ngIf="player.paused">Shalom {{ player.firstName }}! Du pausierst gerade.</ion-label>
  </ion-item>

  <ion-accordion-group #signoutAccordionGroup [value]="'second'">
    <ion-accordion value="first" [disabled]="attendances.length === 0">
      <ion-item slot="header" color="light" (click)="presentActionSheetForChoice()">
        <ion-label>Abmeldungen pflegen</ion-label>
      </ion-item>
      <div slot="content">
        <ion-list>
          <ion-item *ngIf="attendances.length" lines="none">
            <ion-label>Termine auswählen</ion-label>
            <ion-select multiple="true" [(ngModel)]="selAttIds">
              <ion-select-option [value]="att.id" *ngFor="let att of attendances">{{ att.date | date:'dd.MM.YYYY' }}
                {{ att.typeInfo }}</ion-select-option>
            </ion-select>
          </ion-item>
          <div>
            <ion-list #ReasonIonSelect>
              <ion-item class="margin-auto">
                <ion-select [(ngModel)]="reasonSelection" (ionChange)="onReasonSelect($event)" class="margin-auto" aria-label="reason-ion-select" interface="action-sheet" placeholder="Grund auswählen">
                  <ion-select-option value="Krankheitsbedingt">Krankheitsbedingt</ion-select-option>
                  <ion-select-option value="Urlaubsbedingt">Urlaubsbedingt</ion-select-option>
                  <ion-select-option value="Arbeitsbedingt">Arbeitsbedingt</ion-select-option>
                  <ion-select-option value="Familienbedingt">Familienbedingt</ion-select-option>
                  <ion-select-option value="Sonstiger Grund">Sonstiger Grund (Text)</ion-select-option>
                </ion-select>
              </ion-item>
            </ion-list>
          </div>
          <ion-item *ngIf="selAttIds.length && (reasonSelection === 'Sonstiger Grund')">
            <ion-label position="stacked">Grund</ion-label>
            <ion-textarea placeholder="Mindestens 5 Zeichen eingeben..." [(ngModel)]="reason"></ion-textarea>
          </ion-item>
        </ion-list>
        <ion-button *ngIf="attendances.length" (click)="signout()" [disabled]="!(reason && reason.length > 4)"
          expand="block">
          Abmeldung einreichen</ion-button>
      </div>
    </ion-accordion>

    <ion-accordion value="second">
      <ion-item slot="header" color="light">
        <ion-label>Meine Anwesenheit</ion-label>
      </ion-item>
      <div slot="content">
        <ion-list>
          <ng-container *ngFor="let att of playerAttendance">
            <ion-item-divider *ngIf="att.showDivider">
              <ion-label>Vergangene</ion-label>
              <ion-badge [color]="perc >= 75 ? 'success' : perc >= 50 ? 'warning' : 'danger'" style="margin-right: '16px'" slot="end">Ø {{ perc }}%</ion-badge>
            </ion-item-divider>
            <ion-item [button]="canEdit(att.id) ? 'true' : 'false'" (click)="removeExcuse(att.id)" [color]="canEdit(att.id) ? 'primary' : ''">
              <ion-label>
                <h2 *ngIf="att.title">{{ att.date | date:'dd.MM.yyyy' }} | {{ att.title }}</h2>
                <h2 *ngIf="!att.title">{{ att.date | date:'dd.MM.yyyy' }}</h2>
              </ion-label>

              <ion-badge slot="end" [color]="att.text === 'X' ? 'success' : att.text === 'A' ? 'danger' : att.text === 'L' ? 'tertiary' : att.text === 'N' ? 'medium' : 'warning'">
                {{ att.text }}</ion-badge>
            </ion-item>
          </ng-container>
        </ion-list>
      </div>
    </ion-accordion>
  </ion-accordion-group>
  <!-- <ion-label class="version">Version {{ version }}</ion-label> TODO!!! -->
</ion-content>
