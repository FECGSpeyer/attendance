<ion-header [translucent]="true">
  <ion-toolbar color="light">
    <ion-title>Registrierung</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content color="light" [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar color="light">
      <ion-title size="large">Registrierung</ion-title>
    </ion-toolbar>
  </ion-header>

  <ion-list [inset]="true">
    @if (tenantData) {
    <ion-card>
      <ion-card-header>
        <ion-icon class="headerIcon" name="business-outline"></ion-icon>
      </ion-card-header>
      <ion-card-content>
        <ion-title class="paddingTitle">{{ tenantData.longName }}</ion-title>
        <br>
        <p>Registriere dich über dieses Formular für die oben genannte Instanz.</p>
      </ion-card-content>
    </ion-card>

    <ion-list-header><ion-label>Account</ion-label></ion-list-header>
    @if (!db.user) {
    <ion-item-group>
      <ion-item button detail="false" (click)="login()">
        <ion-label color="primary">Account bereits vorhanden? Hier anmelden</ion-label>
      </ion-item>
      <ion-item>
        <ion-label position="stacked">E-Mail Adresse</ion-label>
        <ion-input [(ngModel)]="email" type="email" autocomplete="email"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="stacked">Passwort</ion-label>
        <ion-input [(ngModel)]="password" type="password" autocomplete="new-password"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="stacked">Passwort bestätigen</ion-label>
        <ion-input [(ngModel)]="confirmPassword" type="password" autocomplete="new-password"></ion-input>
      </ion-item>
    </ion-item-group>
    } @else {
    <ion-item-group>
      <ion-item>
        <ion-label>Du bist angemeldet als {{ db.user.email }}.</ion-label>
      </ion-item>
    </ion-item-group>
    }

    <ion-list-header><ion-label>Persönliche Daten</ion-label></ion-list-header>
    <ion-item-group>
      <ion-item *ngIf="tenantData.registration_fields?.includes('picture')" (click)="changeImg()" button detail="false">
        <ion-avatar slot="start">
          <img [src]="profilePicture" />
        </ion-avatar>
        <ion-label color="primary">Wähle ein Passbild aus (max. 2 MB)</ion-label>
        <input style="display: none;" name="file" #chooser (change)="onImageSelect($event)" accept="image/*"
          class="inputFile" type="file" />
      </ion-item>
      <ion-item>
        <ion-label position="stacked">Vorname</ion-label>
        <ion-input [(ngModel)]="firstName" type="text" autocomplete="given-name"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="stacked">Nachname</ion-label>
        <ion-input [(ngModel)]="lastName" type="text" autocomplete="family-name"></ion-input>
      </ion-item>
      <ion-item *ngIf="tenantData.registration_fields?.includes('birthDate')">
        <ion-label>Geburtsdatum</ion-label>
        <ion-datetime-button datetime="birthdateReg"></ion-datetime-button>
        <ion-modal [keepContentsMounted]="true">
          <ng-template>
            <ion-datetime [(ngModel)]="birthDate" presentation="date" id="birthdateReg" locale="de-DE"></ion-datetime>
          </ng-template>
        </ion-modal>
      </ion-item>
      <ion-item *ngIf="tenantData.registration_fields?.includes('phone')">
        <ion-label position="stacked">Handynummer</ion-label>
        <ion-input [(ngModel)]="phone" type="tel" autocomplete="tel"></ion-input>
      </ion-item>
    </ion-item-group>

    <ion-list-header><ion-label>Weitere Informationen</ion-label></ion-list-header>
    <ion-item-group>
      <ion-item>
        <ion-select label="Gruppe" [(ngModel)]="selectedGroupId" #select>
          <ion-select-option [value]="group.id" *ngFor="let group of groups">{{ group.name }}</ion-select-option>
        </ion-select>
      </ion-item>
      @for (field of additionalFields; track field.name) {
      <ion-item>
        @if (field.type === 'text') {
        <ion-label position="stacked">{{ field.name }}</ion-label>
        <ion-input [(ngModel)]="field.value" type="text"></ion-input>
        } @else if (field.type === 'number') {
        <ion-label position="stacked">{{ field.name }}</ion-label>
        <ion-input [(ngModel)]="field.value" type="number"></ion-input>
        } @else if (field.type === 'select') {
        <ion-select [label]="field.name" [(ngModel)]="field.value">
          <ion-select-option *ngFor="let option of field.options" [value]="option">{{ option }}</ion-select-option>
        </ion-select>
        } @else if (field.type === 'boolean') {
        <ion-label>{{ field.name }}</ion-label>
        <ion-toggle slot="end" [(ngModel)]="field.value"></ion-toggle>
        } @else if (field.type === 'bfecg_church') {
        <ion-select interface="modal" [label]="field.name" [(ngModel)]="field.value">
          <ion-select-option value="">Nicht gelistet</ion-select-option>
          <ion-select-option *ngFor="let church of churches" [value]="church.id">{{ church.name }}</ion-select-option>
        </ion-select>
        }
      </ion-item>
      @if (field.type === 'bfecg_church' && field.value === '') {
      <ion-item>
        <ion-label position="stacked">Bitte gib den Namen deiner Gemeinde ein</ion-label>
        <ion-input [(ngModel)]="customChurchName" type="text"></ion-input>
      </ion-item>
      }
      }
      <ion-item>
        <ion-label position="stacked">Bemerkungen (optional)</ion-label>
        <ion-textarea [(ngModel)]="notes"></ion-textarea>
      </ion-item>
    </ion-item-group>
    }

    <ion-item-group>
      <ion-item color="primary" (click)="register()" button detail="false">
        <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
        <ion-label>Registrierung abschließen</ion-label>
      </ion-item>
    </ion-item-group>
  </ion-list>
</ion-content>